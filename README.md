# Итоговый проект: Анализ временного ряда NYC Taxi Demand

## Цель проекта
Целью проекта является проведение полного анализа временного ряда, отражающего количество поездок на такси в Нью-Йорке с 30-минутным интервалом. Работа охватывает: предварительное исследование, сравнение методов предсказания, построение SARIMA-модели, классификацию сегментов (в том числе с использованием глубинного обучения) и обнаружение аномалий. Все этапы реализованы с пояснением решений и визуализацией.

---

## 1. Предварительный анализ временного ряда

Данные взяты из открытого источника — NYC Taxi Demand. Временной ряд охватывает период с 1 июля 2014 по 31 января 2015 года, шаг данных — 30 минут. Пропущенные значения и дубликаты отсутствуют.

График временного ряда показал выраженную суточную и недельную сезонность, а также сильные пики нагрузки в утренние и вечерние часы.

ADF-тест на стационарность:

- ADF-статистика: -10.76
- p-value: 2.47e-19
- Критические значения: (1%: -3.43, 5%: -2.86, 10%: -2.56)

**Вывод:** Временной ряд стационарен по уровню, сильная сезонность требует дополнительной обработки при построении прогностических моделей.

---

## 2. Прогнозирование: сравнение базовых методов

Для прогноза на 7 дней (336 точек) были протестированы три подхода:

- **Наивный метод** — повторение последнего значения
- **Скользящее среднее** — среднее за последние 48 точек (1 сутки)
- **Экспоненциальное сглаживание** — модель SimpleExpSmoothing из `statsmodels`

### Метрики:

| Метод                | MAE     | RMSE    | MAPE   |
|----------------------|---------|---------|--------|
| Наивный              | 13156   | 15292   | 5142   |
| Скользящее среднее   | **7175**| **8810**| **3278**|
| Эксп. сглаживание    | 13155   | 15291   | 5142   |

**Вывод:** Скользящее среднее показало лучшую точность по всем метрикам. Несмотря на простоту, этот метод адекватно учитывает сезонные флуктуации и устойчив в условиях стабильных паттернов.

---

## 3. SARIMA: ручной подбор параметров и анализ

Попытки автоматического подбора параметров SARIMA привели к сбоям ядра. Поэтому модель была настроена вручную, на основе графиков автокорреляции (ACF) и частичной автокорреляции (PACF):

- **Обычные лаги**: p=2, d=1, q=2
- **Сезонность**: P=1, D=1, Q=1, s=48 (сутки по 30 минут)

SARIMA обучалась на 14 последних дней обучающей выборки. После построения модели были проанализированы остатки — ACF и PACF остатков показали, что модель адекватно устранила основную зависимость. Остаточная часть ведёт себя как белый шум.

### Метрики SARIMA:

| MAE     | RMSE    | MAPE   |
|---------|---------|--------|
| 14073   | 15450   | 3713   |

**Вывод:** Несмотря на качественное описание сезонной структуры, SARIMA не смогла превзойти скользящее среднее, что может быть связано со сложной нелинейной динамикой и шумовыми выбросами в данных.

---

## 4. Классификация сегментов по времени суток

Сегменты длиной 48 точек (1 сутки) были размечены по времени в середине сегмента на четыре класса:

- `night`: 0:00–6:00
- `morning`: 6:00–12:00
- `day`: 12:00–18:00
- `evening`: 18:00–24:00

### Протестированные методы:

- **kNN с DTW** (расстояние между рядами)
- **Time Series Forest** (SKTime)
- **ROCKET** (Random convolutional kernels)

### Метрики:

| Метод             | Accuracy |
|------------------|----------|
| kNN + DTW        | 0.97     |
| TimeSeriesForest | 0.97     |
| ROCKET           | **0.98** |

**Вывод:** Все три метода достигли высокой точности. ROCKET оказался немного точнее за счёт эффективности случайных свёрточных признаков.

---

## 5. Классификация сегментов с использованием `tsai`

Сегменты (48 точек, 1 канал) использовались для обучения модели InceptionTime из библиотеки `tsai`.

- **Модель:** InceptionTime
- **Метрика:** Accuracy
- **Устройство:** GPU (CUDA)
- **Обработка:** стандартизация, разбивка на train/valid

### Результаты:

- 10 эпох обучения, финальная точность: **1.00**
- Confusion matrix — все классы классифицируются корректно
- Визуализация предсказаний подтверждает интерпретируемость

**Вывод:** InceptionTime успешно справилась с задачей и показала высокий потенциал для мультиклассовой классификации сегментов ВР.

---

## 6. Обнаружение аномалий

Проверялись как точечные выбросы, так и сегментные отклонения. Применены следующие методы:

- **Z-score** — на основе скользящего среднего
- **Isolation Forest** — выделяет аномалии по изоляции в пространстве признаков
- **AutoEncoder (LSTM)** — реконструирует сегменты и сравнивает ошибку

### Наблюдения:

- **Z-score** — эффективен только для экстремальных выбросов
- **Isolation Forest** — обнаруживает более сложные и распределённые аномалии
- **AutoEncoder** — хорошо ловит нетипичные сегменты, включая перепады сезонности

**Вывод:** для мониторинга желательно использовать AutoEncoder в сочетании с пороговыми методами.

---

## Финальные рекомендации

- **Прогнозирование:** Для краткосрочного прогноза эффективнее всего использовать простое скользящее среднее.
- **Классификация:** Использование tsai (InceptionTime) даёт выдающиеся результаты и подходит для задач с явными паттернами.
- **Аномалии:** Рекомендуется использовать AutoEncoder с реконструкцией — он устойчив к шуму и обнаруживает как точечные, так и структурные отклонения.

---
